(this["webpackJsonpremirror-yjs-webrtc-demo"]=this["webpackJsonpremirror-yjs-webrtc-demo"]||[]).push([[0],{479:function(e,t,n){},480:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n(61),a=n.n(r),o=n(62),s=n.n(o),i=n(92),u=n(246),b=n.n(u),d=n(506),j=Object(c.createContext)({id:"unknown",name:"Unknown User"}),l=n(40),f=n(147),O=n(37),v=n(505),h=n(263),p=n(504);var m=function(){return Object(c.useContext)(j)},x=n(29),w=n(264),k=n(80);var C=function(e,t){return e[t.split("").reduce((function(e,t){return e+t.charCodeAt(0)}),0)%e.length]},g=["#357a8d","#205a6d","#86afbb","#c2d7dd","#bbb350","#a29835","#d6d196","#ec7f48","#e35f2e","#9973d2","#f9d9c8","#d1505f","#Be3541","#e3969f","#f1cbcf","#8a6a8a","#6a4b6a","#b9a6b9","#dcd2dc","#7d916b","#5d724c","#b1bda6","#d8ded3","#eacc8a","#e0b86a","#a1888b","#83686b","#c7b8b9"],y=function(e){return C(g,e)};var S=function(e,t){return Object(c.useMemo)((function(){var n=new k.a(t);return n.setLocalStateField("user",{name:e.name,color:y(e.name)}),n}),[e.name,t])};var N=function(e,t){var n=Object(c.useMemo)((function(){return new x.d({guid:t})}),[t]),r=S(e,n);return Object(c.useMemo)((function(){var e="remirror-yjs-webrtc-demo-room-".concat(t);return new w.a(e,n,{awareness:r})}),[r,n,t])};var M=function(e,t,n){var r=Object(c.useRef)();Object(c.useEffect)((function(){r.current=t}),[t]),Object(c.useEffect)((function(){var t=function(e){var t;return null===(t=r.current)||void 0===t?void 0:t.call(r,e)};return n.on(e,t),function(){n.off(e,t)}}),[e,n])},E=n(2),J=n(507),A=n(136),B=n(5),R=function(){var e=Object(c.useState)(!1),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(O.e)(),o=Object(O.h)().getAnnotationsAt,s=Object(c.useMemo)((function(){return[{type:v.a.ToolbarButton,onClick:function(){a.addAnnotation({id:Object(E.O)()})},icon:"chatNewLine"}]}),[a]),i=o().map((function(e){return e.text})).join("\n"),u=Object(J.a)(Object(f.c)(o),[]);return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(v.c,{items:s,positioner:"selection",placement:"top"}),Object(B.jsx)(v.d,{children:Object(B.jsx)("div",{style:{top:u.y+u.height,left:u.x,position:"absolute",border:"1px solid black",whiteSpace:"pre-line",background:"white"},ref:u.ref,children:i})}),Object(B.jsx)(v.b,{visible:n,onUpdate:function(e){return r(e)},backdrop:!0,children:Object(B.jsx)(A.a,{onClick:function(){a.addAnnotation({id:Object(E.O)()}),r(!1)},children:"Done"})})]})},F=function(){var e=Object(O.f)(),t=e.from,n=e.to,c=(0,Object(O.h)(!0).getAnnotations)();return Object(B.jsxs)("pre",{children:[Object(B.jsxs)("code",{children:["Selection: ",t,"-",n]}),Object(B.jsx)("br",{}),Object(B.jsx)("code",{children:JSON.stringify(c,null,2)})]})},T=(n(366),3e3+Math.floor(7e3*Math.random())),I=function(e){var t=e.success,n=void 0!==t&&t;return Object(B.jsx)("span",{className:"status ".concat(n?"success":""),children:"\xa0"})};var D=function(e){var t=e.documentId,n=e.onFetch,r=e.onSave,a=Object(c.useRef)(!1),o=m(),u=N(o,t),b=Object(c.useState)(0),d=Object(l.a)(b,2),j=d[0],x=d[1],w=Object(c.useState)(!1),k=Object(l.a)(w,2),C=k[0],g=k[1],y=Object(c.useState)(),S=Object(l.a)(y,2),E=S[0],J=S[1],A=Object(c.useCallback)((function(e){var t=e.state,n=e.tr;(null===n||void 0===n?void 0:n.docChanged)&&J(t.toJSON().doc)}),[J]),D=Object(c.useCallback)((function(e){(C||0===j)&&(r(t,JSON.stringify(e)),u.doc.getMap("meta").set("lastSaved",Date.now()))}),[r,t,u.doc,C,j]),G=Object(p.a)(D,T),L=Object(c.useCallback)((function(e){var t=e.webrtcPeers;x(t.length)}),[x]);M("peers",L,u);var P=Object(c.useCallback)((function(e){var t=e.synced;g(t)}),[g]);M("synced",P,u),Object(c.useEffect)((function(){G(E)}),[G,E]);var U=Object(c.useCallback)((function(){G.cancel()}),[G]);M("update",U,u.doc);var K=Object(c.useCallback)((function(){return[new f.b({getProvider:function(){return u}}),new f.a]}),[u]),H=Object(O.j)({extensions:K}),V=H.manager,W=H.getContext;return Object(c.useEffect)((function(){if(!a.current){var e=function(){var e=Object(i.a)(s.a.mark((function e(){var c,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.connected||0!==j){e.next=5;break}return e.next=3,n(t);case 3:r=e.sent,null===(c=W())||void 0===c||c.setContent(JSON.parse(r));case 5:a.current=!0;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=window.setTimeout(e,1e3);return function(){window.clearTimeout(c)}}}),[n,t,u.connected,j,W]),Object(B.jsx)(v.e,{children:Object(B.jsxs)(O.b,{manager:V,onChange:A,children:[Object(B.jsx)(O.a,{}),Object(B.jsx)(R,{}),Object(B.jsx)(h.a,{}),Object(B.jsxs)("div",{className:"info-box",children:[Object(B.jsxs)("p",{className:"info",children:["Connected clients: ",j+1]}),Object(B.jsxs)("p",{className:"info",children:["Synced: ",Object(B.jsx)(I,{success:C||0===j})]})]}),Object(B.jsx)(F,{})]})})},G=["Ollie Ewing","Charles Hays","Jim Bean","Richard Reeves","Frank Graves","Grant Emerson","Charles Yates","Ian Sims","Herbert Warren","Martin Noel","Billy Long","Douglas Giles","Stephen Knight","Brendan Cook","Robert Evans","Mathew Richard","Drew Chase","Adeline Barrera","Estelle Turner","Velma Beasley","Irene Goodwin","Jeanette Jones","Robin Flowers","Pamela Spears","Kristin Alford","Charlotte Stone","Kirsten Turner"],L=function(e){return C(G,e)},P=b.a.create({baseURL:"https://60b9308780400f00177b6434.mockapi.io/yjs-webrtc/v1/",headers:{"Content-Type":"application/json"}});var U=function(){var e=Object(c.useMemo)((function(){var e=Object(d.a)();return{id:e,name:L(e)}}),[]),t=Object(c.useCallback)(function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.get("documents/".concat(t));case 2:return n=e.sent,e.abrupt("return",n.data.body);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),n=Object(c.useCallback)(function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.put("/documents/".concat(t),{body:n});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]);return Object(B.jsx)(j.Provider,{value:e,children:Object(B.jsx)("div",{className:"app",children:Object(B.jsx)(D,{documentId:"e575831a-e213-49e2-9092-a604d3e0f654",onFetch:t,onSave:n})})})};n(479);a.a.render(Object(B.jsx)(U,{}),document.getElementById("root"))}},[[480,1,2]]]);
//# sourceMappingURL=main.903617b2.chunk.js.map